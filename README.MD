# ğŸ—ï¸ MallHive Infrastructure

This repository contains infrastructure code, Kubernetes manifests, CI/CD automation, and observability for the **MallHive e-commerce platform**.
It manages everything from provisioning clusters and deploying services to monitoring, security, and data pipelines.

---

## ğŸ“ High-Level Architecture

```mermaid
flowchart LR
    A[Users] --> B[Route53 / CloudFront / ALB]
    B --> C[EKS Cluster]
    C -->|Microservices| D[(RDS / S3 / OpenSearch)]
    C --> E[ETL Pipeline (Kinesis + Lambda)]
    C --> F[Observability (Prometheus + Grafana + Loki)]
```

---

## ğŸ“ Repo Structure

```plaintext
mallhive-infra/
â”œâ”€â”€ argocd/                   # Argo CD Applications (per microservice + app-of-apps)
â”œâ”€â”€ codebuild/                # AWS CodeBuild buildspecs
â”œâ”€â”€ codepipeline/             # CloudFormation templates for CodePipeline
â”œâ”€â”€ ci/                       # Jenkins pipelines (ETL, EKS, shared logic)
â”œâ”€â”€ dockerfiles/              # Dockerfiles for all microservices
â”œâ”€â”€ etl-pipeline/             # ETL jobs and Lambda code
â”œâ”€â”€ kubernetes/               # Kubernetes add-ons, operators, and microservices
â”œâ”€â”€ observability/            # Monitoring & logging stack (Prometheus, Grafana, Loki, CloudWatch)
â”œâ”€â”€ MLOps/                    # MLOps pipelines and workflows
â”œâ”€â”€ scripts/                  # Helper automation scripts
â””â”€â”€ terraform
â””â”€â”€ README.md

```

---

## ğŸ§© Components by Concern

* **Infrastructure** â†’ Terraform modules, Karpenter autoscaling, AWS Load Balancer Controller
* **Application Delivery** â†’ Argo CD apps, Kubernetes manifests, Dockerfiles
* **Data & Analytics** â†’ ETL pipeline (Kinesis + Lambda), Redshift/S3 integration
* **Observability** â†’ Prometheus, Grafana dashboards, Loki logs, CloudWatch exporters
* **Security** â†’ Kyverno policies, IAM least privilege, AWS Secrets Manager, TLS/ACM
* **MLOps** â†’ Training and deployment workflows (future scope)

---

## ğŸ“¦ Microservices

| Service            | Dockerfile Path                         | Deployment Path                                      |
| ------------------ | --------------------------------------- | ---------------------------------------------------- |
| User Service       | `dockerfiles/user.dockerfile`           | `kubernetes/micro-services/user-service/`            |
| Order Service      | `dockerfiles/order.dockerfile`          | `kubernetes/micro-services/order-service/`           |
| Product Service    | `dockerfiles/product.dockerfile`        | `kubernetes/micro-services/product-service/`         |
| Payment Service    | `dockerfiles/payment.dockerfile`        | `kubernetes/micro-services/payment-service/`         |
| Cart Service       | `dockerfiles/shoppingcart.dockerfile`   | `kubernetes/micro-services/cart-service/`            |
| Recommendation Svc | `dockerfiles/recommendation.dockerfile` | `kubernetes/micro-services/recommendations-service/` |
| Analytics Service  | `dockerfiles/analytics.dockerfile`      | `kubernetes/micro-services/analytics-service/`       |

---

## ğŸš€ Quickstart

### 1. Provision Infrastructure

```bash
cd terraform/environments/dev
terraform init
terraform apply
```

### 2. Bootstrap Argo CD

```bash
kubectl apply -f kubernetes/argocd/namespace.yaml
kubectl apply -f argocd/app-of-apps.yaml
```

### 3. Build & Push a Microservice

```bash
docker build -t <ECR_REPO>/mallhive-user:latest -f dockerfiles/user.dockerfile .
docker push <ECR_REPO>/mallhive-user:latest
```

Argo CD will sync deployments automatically.

---

## ğŸ“Š ETL Pipeline

MallHive includes an **event-driven ETL system** for analytics.

* `etl-pipeline/lambda/` â†’ Lambda transformation logic
* `terraform/etl/` â†’ Infra setup (Kinesis, IAM, Lambda)
* `ci/etl/` â†’ Jenkins pipelines
* `.github/workflows/etl-pipeline.yml` â†’ GitHub Actions alternative

---

## ğŸ” Observability

The `observability/` stack provides full visibility:

* **Prometheus** â†’ metrics scraping
* **Grafana** â†’ dashboards
* **Loki** â†’ logs
* **CloudWatch** â†’ AWS metrics + exporters

---

## ğŸ›¡ï¸ Security

* Secrets in **AWS Secrets Manager** or **SSM Parameter Store**
* **Kyverno** policies for pod security and image signing
* **KMS** encryption for sensitive data
* **IAM least privilege** enforced across CI/CD and services

---

## ğŸ“Œ Future Improvements

* [ ] Add service mesh (Linkerd or Istio)
* [ ] Integrate OpenTelemetry tracing
* [ ] Expand MLOps pipelines for model deployment
* [ ] Harden CI/CD with artifact signing

---

## âœï¸ Contributions

Infra evolves fast. Open a PR or issue if you have improvements or fixes.

---