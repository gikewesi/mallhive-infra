# ğŸ“¦ Order Service â€“ Deployment on AWS EKS with Fargate

This folder contains the Kubernetes Helm chart and deployment configuration for the **Order Service**, a Go-based microservice responsible for **order placement, tracking, and fulfillment**. It is designed to run securely and scalably on **Amazon EKS with Fargate**.

---

## ğŸ§© Overview

The **Order Service** is the backbone of Mallhive's ordering system. It:

* Accepts and processes new orders
* Tracks order status and fulfillment
* Interacts with product, payment, analytics, and notification services
* Publishes domain events via **Kafka** or **AWS EventBridge**
* Stores and queries order data in **PostgreSQL on AWS RDS**
* Runs in a fully containerized, serverless EKS Fargate environment

---

## ğŸ”§ Architecture

* **Kubernetes Platform**: Amazon EKS (1 cluster, Fargate profile for `order-service`)
* **Networking**: Internal **ALB** + **Route 53**, private subnets only
* **Database**: PostgreSQL (AWS RDS)
* **Message/Event Bus**: Kafka or AWS SQS, AWS EventBridge
* **Image Registry**: Amazon ECR (`mallhive-order-service`)
* **Ingress Security**: HTTPS with **ACM certificate**, internal DNS via `order.internal.mallhive.com`
* **Namespace**: `order-service`
* **Service Communication**: Across microservices using DNS + `NetworkPolicy`

---

## ğŸ”— Service Communication

**Services that send requests to Order Service**
ğŸ’³ **checkout.mallhive.com** (Microfrontend) â†’ Creates a new order
ğŸ‘¤ **user-profile.mallhive.com** (Microfrontend) â†’ Fetches userâ€™s past orders

**Services that receive requests from Order Service**
ğŸ“¦ **Product Microservice** â†’ Update stock when an order is placed
ğŸ“© **Notification Microservice** â†’ Send order confirmation to the user
ğŸ’° **Payment Microservice** â†’ Initiate and verify payment for the order
ğŸ“Š **Analytics Microservice** â†’ Log order success or failure events

**Services that respond back to Order Service**
ğŸ’° **Payment Microservice** â†’ Confirms if payment was successful or failed

---

## ğŸ“ Folder Structure

```
order-service/
â”œâ”€â”€ helm/
â”‚   â”œâ”€â”€ Chart.yaml
â”‚   â”œâ”€â”€ values.yaml
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ configmap.yaml
â”‚       â”œâ”€â”€ deployment.yaml
â”‚       â”œâ”€â”€ hpa.yaml
â”‚       â”œâ”€â”€ ingress.yaml
â”‚       â”œâ”€â”€ service.yaml
â”‚       â”œâ”€â”€ serviceaccount.yaml
â”‚       â”œâ”€â”€ networkpolicy.yaml
â”‚       â”œâ”€â”€ namespace.yaml
â”œâ”€â”€ README.md
```

---

## ğŸ” Secrets & IAM (IRSA)

The service **does not store any secrets in Kubernetes**. All credentials (e.g., DB credentials, Kafka/SQS credentials) are fetched at runtime from **AWS Secrets Manager**, using **IAM Role for Service Account (IRSA)**.

### IAM Permissions Example

```json
{
  "Effect": "Allow",
  "Action": [
    "secretsmanager:GetSecretValue"
  ],
  "Resource": "arn:aws:secretsmanager:us-east-1:123456789012:secret:order-service/*"
}
```

---

## ğŸš€ Deployment via Helm

```bash
helm upgrade --install order-service ./helm \
  --namespace order-service \
  --create-namespace
```

> **Prerequisites:**
>
> * IRSA and Fargate profile created for `order-service`
> * ECR image is pushed (`mallhive-order-service`)
> * ACM certificate and Route 53 entries are valid

---

## ğŸ“Š Monitoring & Observability

| Layer               | Tooling                                                          |
| ------------------- | ---------------------------------------------------------------- |
| EKS Control Plane   | CloudWatch                                                       |
| Fargate Pod Metrics | Prometheus (cAdvisor via kubelet), Alertmanager for alerts       |
| Logs                | Loki + Promtail (pod logs, Kubernetes events, ingress logs)      |
| Visualization       | Grafana (single pane for metrics, logs, and traces)              |
| Event Processing    | Kafka/AWS SQS monitoring dashboards + EventBridge metrics        |
| Policy & Governance | Kyverno for admission control, security, and compliance policies |

---

## ğŸ—ºï¸ Architecture Diagram

![Order Service Architecture](./ORDER-SERVICE.drawio.png)

---

## âœ… Requirements

* âœ… EKS cluster with Fargate enabled
* âœ… IRSA-enabled `ServiceAccount` and IAM role
* âœ… PostgreSQL (AWS RDS) in same VPC
* âœ… Kafka/SQS + EventBridge configured
* âœ… ALB Ingress Controller and valid ACM certificate
* âœ… Route 53 DNS record
* âœ… Helm installed and configured with kubeconfig
* âœ… ECR image pushed (`mallhive-order-service`)

---