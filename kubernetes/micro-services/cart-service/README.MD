# ðŸ›’ Cart Service â€“ Deployment on AWS EKS with Fargate

This folder contains the Kubernetes Helm chart and deployment configuration for the **Cart Service**, a Go-based microservice for managing shopping cart operations within the Mallhive platform. It is designed to run securely and scalably on **Amazon EKS with Fargate**.

---

## ðŸ§© Overview

The **Cart Service** handles:

* Adding and removing products from a cart
* Fetching cart contents for users
* Tracking product availability during checkout
* Publishing checkout events to other services
* Maintaining cart state in **Redis**
* Persisting inventory data in **PostgreSQL on AWS RDS**
* Secure HTTPS ingress via **ACM-backed ALB**

---

## ðŸ”§ Architecture

* **Kubernetes Platform**: Amazon EKS (1 cluster, Fargate profiles per microservice)
* **Networking**: Internal **ALB** + **Route 53**, private subnets only
* **In-Memory Store**: Redis (for cart state)
* **Database**: PostgreSQL (AWS RDS for inventory data)
* **Events**: AWS SNS for publishing checkout events
* **Image Registry**: Amazon ECR (`mallhive-cart-service`)
* **Ingress Security**: HTTPS with **ACM certificate**, internal DNS via `cart.internal.mallhive.com`
* **Namespace**: `cart-service` (with its own Fargate profile)
* **Service Communication**: Across microservices using DNS (`service-name.namespace.svc.cluster.local`) + `NetworkPolicy`

---

## ðŸ“¡ Service Communication

### Services/Microfrontends that Send Requests to Cart Service

* **ðŸ›’ cart.mallhive.com (Microfrontend)** â€“ Fetch cart, add/remove items
* **ðŸ’³ checkout.mallhive.com (Microfrontend)** â€“ Get final cart details before checkout

### Services the Cart Service Sends Requests/Events to

* **âœ… Product Service** â€“ Confirm item status on checkout (via event)
* **ðŸ“Š Analytics Service** â€“ Send cart usage metrics/events

### Services that Send Direct Requests to Cart Service

* **None** â€“ No direct service-to-service incoming requests

---

## ðŸ“ Folder Structure

```
cart-service/
â”œâ”€â”€ helm/
â”‚   â”œâ”€â”€ Chart.yaml
â”‚   â”œâ”€â”€ values.yaml
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ configmap.yaml
â”‚       â”œâ”€â”€ deployment.yaml
â”‚       â”œâ”€â”€ hpa.yaml
â”‚       â”œâ”€â”€ ingress.yaml
â”‚       â”œâ”€â”€ service.yaml
â”‚       â”œâ”€â”€ serviceaccount.yaml
â”‚       â”œâ”€â”€ networkpolicy.yaml
â”‚       â”œâ”€â”€ namespace.yaml
â”œâ”€â”€ README.md
```

---

## ðŸ” Secrets & IAM (IRSA)

The Cart Service **does not store secrets in Kubernetes**. All credentials (e.g., DB credentials, Redis connection details, SNS topics) are fetched at runtime from **AWS Secrets Manager**, using **IAM Role for Service Account (IRSA)**.

### IAM Permissions

```json
{
  "Effect": "Allow",
  "Action": [
    "secretsmanager:GetSecretValue",
    "sns:Publish"
  ],
  "Resource": [
    "arn:aws:secretsmanager:us-east-1:123456789012:secret:cart-service/*",
    "arn:aws:sns:us-east-1:123456789012:checkout-events"
  ]
}
```

---

## ðŸ“¦ Deployment via Helm

```bash
helm upgrade --install cart-service ./helm \
  --namespace cart-service \
  --create-namespace
```

> This assumes:
>
> * You have IRSA and Fargate profile created for `cart-service`
> * The ECR image is pushed
> * Your ACM cert + Route 53 entries are valid

---

## ðŸ“Š Monitoring & Observability

| Layer               | Tooling                                                          |
| ------------------- | ---------------------------------------------------------------- |
| EKS Control Plane   | CloudWatch                                                       |
| Fargate Pod Metrics | Prometheus (cAdvisor via kubelet), Alertmanager for alerts       |
| Logs                | Loki + Promtail (pod logs, Kubernetes events, ingress logs)      |
| Visualization       | Grafana (single pane for metrics, logs, and traces)              |
| Cluster Autoscaling | Karpenter for dynamic scaling of workloads                       |
| Policy & Governance | Kyverno for admission control, security, and compliance policies |

---


## âœ… Requirements

* âœ… EKS cluster w/ Fargate enabled
* âœ… IRSA-enabled `ServiceAccount` and IAM role
* âœ… RDS PostgreSQL and Redis in same VPC
* âœ… ALB Ingress Controller and valid ACM cert
* âœ… DNS record in Route 53 (`cart.internal.mallhive.com`)
* âœ… Helm installed and configured with kubeconfig
* âœ… ECR image pushed (`mallhive-cart-service`)

---