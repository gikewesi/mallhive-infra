# üßæ Product Service ‚Äì Deployment on AWS EKS with Fargate

This folder contains the Kubernetes Helm chart and deployment configuration for the **Product Service**, a Go-based microservice responsible for managing product data and serving product information to both internal services and frontend applications. It runs securely and scalably on **Amazon EKS with Fargate**.

---

## üß© Overview

The **Product Service** handles:

* Product catalog management (create, update, delete products)
* Category and filter management
* Pricing and stock level tracking
* Availability verification during checkout
* Metadata delivery for analytics and recommendations
* Database interactions with **PostgreSQL on AWS RDS**
* Runtime credential access via **AWS Secrets Manager**
* Secure HTTPS ingress via **ACM-backed ALB**

---

## üîß Architecture

* **Kubernetes Platform**: Amazon EKS (1 cluster, Fargate profiles per microservice)
* **Networking**: Internal **ALB** + **Route 53**, private subnets only
* **Database**: PostgreSQL (provisioned via AWS RDS)
* **Secrets**: Managed via AWS Secrets Manager
* **Image Registry**: Amazon ECR (`mallhive-product-service`)
* **Ingress Security**: HTTPS with **ACM certificate**, internal DNS via `product.internal.mallhive.com`
* **Namespace**: `product-service` (with its own Fargate profile)
* **Service Communication**: Across microservices using DNS (`service-name.namespace.svc.cluster.local`) + `NetworkPolicy`

---

## üì° Interactions

### üì• Product Service Receives Requests From:

| Sender                          | Type           | Reason                                                                 |
| -------------------------------- | -------------- | ----------------------------------------------------------------------- |
| `cart.mallhive.com`              | Microfrontend  | Display product name and price for items in the user's cart             |
| `products.mallhive.com`          | Microfrontend  | Fetch product catalog, categories, and filters                         |
| `homepage.mallhive.com`          | Microfrontend  | Show featured or new products on the homepage                           |
| `checkout.mallhive.com`          | Microfrontend  | Verify final product availability at checkout                           |
| Cart microservice                | Microservice   | Verify product data (price, stock, name) during checkout                |
| Order microservice               | Microservice   | Lock inventory once an order is placed                                  |

### üì§ Product Service Sends To:

| Receiver                         | Type           | Reason                                                                 |
| -------------------------------- | -------------- | ----------------------------------------------------------------------- |
| Analytics microservice           | Microservice   | Log events like view, click, and save for tracking and reporting        |
| Recommendation microservice      | Microservice   | Send product metadata for building personalized recommendations         |

---

## üìÅ Folder Structure

```

product-service/
‚îú‚îÄ‚îÄ helm/
‚îÇ   ‚îú‚îÄ‚îÄ Chart.yaml
‚îÇ   ‚îú‚îÄ‚îÄ values.yaml
‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ       ‚îú‚îÄ‚îÄ configmap.yaml
‚îÇ       ‚îú‚îÄ‚îÄ deployment.yaml
‚îÇ       ‚îú‚îÄ‚îÄ hpa.yaml
‚îÇ       ‚îú‚îÄ‚îÄ ingress.yaml
‚îÇ       ‚îú‚îÄ‚îÄ service.yaml
‚îÇ       ‚îú‚îÄ‚îÄ serviceaccount.yaml
‚îÇ       ‚îú‚îÄ‚îÄ networkpolicy.yaml
‚îÇ       ‚îú‚îÄ‚îÄ namespace.yaml
‚îú‚îÄ‚îÄ README.md

```

---

## üîê Secrets & IAM (IRSA)

This service **does not store any secrets in Kubernetes**. All secrets (like DB creds) are fetched at runtime using `boto3` (or AWS SDK for Go) from **Secrets Manager**, using **IAM Role for Service Account (IRSA)**.

### IAM Permissions

```json
{
  "Effect": "Allow",
  "Action": [
    "secretsmanager:GetSecretValue"
  ],
  "Resource": "arn:aws:secretsmanager:us-east-1:123456789012:secret:product-service/*"
}
```

---

## üì¶ Deployment via Helm

```bash
helm upgrade --install product-service ./helm \
  --namespace product-service \
  --create-namespace
```

> This assumes:
>
> * You have IRSA and Fargate profile created for `product-service`
> * The ECR image is pushed
> * Your ACM cert + Route 53 entries are valid

---

## üìä Monitoring & Observability

| Layer               | Tooling                                                          |
| ------------------- | ---------------------------------------------------------------- |
| EKS Control Plane   | Cloudwatch                                                       |
| Fargate Pod Metrics | Prometheus (cAdvisor via kubelet), Alertmanager for alerts       |
| Logs                | Loki + Promtail (pod logs, Kubernetes events, ingress logs)      |
| Visualization       | Grafana (single pane for metrics, logs, and traces)              |
| Cluster Autoscaling | Karpenter for dynamic scaling of workloads                       |
| Policy & Governance | Kyverno for admission control, security, and compliance policies |

---

---

## ‚úÖ Requirements

* ‚úÖ EKS cluster w/ Fargate enabled
* ‚úÖ IRSA-enabled `ServiceAccount` and IAM role
* ‚úÖ RDS PostgreSQL instance in same VPC
* ‚úÖ ALB Ingress Controller and valid ACM cert
* ‚úÖ DNS record in Route 53
* ‚úÖ Helm installed and configured with kubeconfig
* ‚úÖ ECR image pushed (`mallhive-product-service`)

---

## üîê Inter-Service Communication (within cluster)

Services talk to each other using Kubernetes DNS:

```
http://analytics-service.analytics.svc.cluster.local
http://recommendation-service.recommendation.svc.cluster.local

```

To allow cross-namespace traffic securely:

* Use `NetworkPolicy` with `namespaceSelector` + `podSelector`
* Or use a service mesh (if planning for mTLS)

```
